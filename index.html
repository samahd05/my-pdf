<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate of Participation - Centre for Sight</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- pdf-lib: A library to create and modify PDF documents in any JavaScript environment. -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <!-- fontkit: An advanced font engine for PDF-lib, required for embedding custom fonts. -->
    <script src="https://unpkg.com/@pdf-lib/fontkit@1.1.1/dist/fontkit.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-lg bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 md:p-8">
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">Certificate of Participation</h1>
            <p class="text-xl font-medium text-gray-600 dark:text-gray-400 mt-1">Centre for Sight</p>
            <p class="text-gray-500 dark:text-gray-400 mt-4">Enter your name below to generate your certificate.</p>
        </div>

        <!-- Step 1: Enter Name -->
        <div class="mb-6">
            <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Full Name
            </label>
            <input type="text" id="name" placeholder="e.g., Jane Doe" class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
        </div>

        <!-- Generate Button -->
        <button id="generate-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 transition-all duration-300 ease-in-out flex items-center justify-center">
            <svg id="icon-default" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
             <svg id="icon-loading" class="animate-spin h-6 w-6 mr-2 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span id="btn-text">Download My Certificate</span>
        </button>
        
        <!-- Message Area -->
        <div id="message-area" class="mt-4 text-center text-sm text-red-600 dark:text-red-400 h-5"></div>

    </div>

    <script>
        // Main function to generate the certificate
        async function generateCertificate() {
            const generateBtn = document.getElementById('generate-btn');
            const btnText = document.getElementById('btn-text');
            const iconDefault = document.getElementById('icon-default');
            const iconLoading = document.getElementById('icon-loading');
            const messageArea = document.getElementById('message-area');

            // --- Get user input ---
            const name = document.getElementById('name').value;

            // --- Input validation ---
            if (!name.trim()) {
                messageArea.textContent = 'Error: Please enter a name.';
                return;
            }
            messageArea.textContent = ''; // Clear previous errors

            // --- UI loading state ---
            btnText.textContent = 'Generating...';
            generateBtn.disabled = true;
            iconDefault.classList.add('hidden');
            iconLoading.classList.remove('hidden');

            try {
                // --- PDF Template URL ---
                const pdfUrl = 'https://raw.githubusercontent.com/samahd05/my-pdf/main/1ab94da1-d2e6-473a-934f-476e86d3e7c0.pdf';

                // --- Load PDF and Font ---
                const { PDFDocument, rgb, StandardFonts } = PDFLib;
                
                const existingPdfBytes = await fetch(pdfUrl).then(res => res.arrayBuffer());
                const pdfDoc = await PDFDocument.load(existingPdfBytes);
                
                pdfDoc.registerFontkit(fontkit);

                // Switched to TimesRoman for a more professional look
                const timesRomanFont = await pdfDoc.embedFont(StandardFonts.TimesRoman);
                
                const pages = pdfDoc.getPages();
                const firstPage = pages[0];
                const { width: pageWidth } = firstPage.getSize();

                // --- Text Style and Position Configuration ---
                const fontSize = 20; // Slightly smaller font size
                const fontColorHex = '#373737';

                // --- Dynamic Centering and Positioning ---
                // Calculate the width of the text to be added
                const textWidth = timesRomanFont.widthOfTextAtSize(name, fontSize);
                
                // Calculate the X coordinate to center the text
                const x = (pageWidth - textWidth) / 2;
                
                // Set the Y coordinate to position the text vertically
                const y = 385; 

                // --- Convert hex color to RGB for pdf-lib ---
                const colorR = parseInt(fontColorHex.slice(1, 3), 16) / 255;
                const colorG = parseInt(fontColorHex.slice(3, 5), 16) / 255;
                const colorB = parseInt(fontColorHex.slice(5, 7), 16) / 255;
                const textColor = rgb(colorR, colorG, colorB);

                // --- Draw the text on the page ---
                firstPage.drawText(name, {
                    x: x,
                    y: y,
                    font: timesRomanFont,
                    size: fontSize,
                    color: textColor,
                });

                // --- Save the PDF and trigger download ---
                const pdfBytes = await pdfDoc.save();
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `Certificate-${name.replace(/\s+/g, '-')}.pdf`;
                document.body.appendChild(link);
                link.click();

                // Clean up
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                messageArea.textContent = 'Certificate generated successfully!';
                messageArea.className = 'mt-4 text-center text-sm text-green-600 dark:text-green-400 h-5';


            } catch (error) {
                console.error('Error generating certificate:', error);
                messageArea.textContent = 'Could not load template. Please check the PDF URL.';
                 messageArea.className = 'mt-4 text-center text-sm text-red-600 dark:text-red-400 h-5';
            } finally {
                // --- Reset UI state ---
                btnText.textContent = 'Download My Certificate';
                generateBtn.disabled = false;
                iconDefault.classList.remove('hidden');
                iconLoading.classList.add('hidden');
            }
        }

        // Attach event listener to the button
        document.getElementById('generate-btn').addEventListener('click', generateCertificate);
    </script>
</body>
</html>
